<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0077be">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="UTF-8">
<title>Beast Player</title>

<style>
:root{
    --bg:#050a0f;      /* Darker Navy */
    --card:#0d151f;    /* Deep Slate */
    --box:#091018;     
    --item:#162431;    /* Muted Blue-Grey */
    --text:#d1e3f0;
    --accent:#0091ea;  /* Deeper Azure */
}

body.light{
    --bg:#e1e9f0;      /* Lighter Steel Blue */
    --card:#f5f9fc;    /* Clean White-Blue */
    --box:#d4e1ec;
    --item:#c5d4e1;
    --text:#051a2b;    /* Deep Navy Text */
    --accent:#0077c2;  /* Unified Azure for Light Mode */
}

body{
    margin:0;
    background:var(--bg);
    color:var(--text);
    font-family:system-ui, Arial;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    transition:background .8s,color .8s;
}

.player{
    width:94%;
    max-width:420px;
    background:var(--card);
    padding:22px;
    border-radius:26px;
    box-shadow:0 25px 60px rgba(0,0,0,.5);
}

.top{
    display:flex;
    justify-content:space-between;
    align-items:center;
}

h1{margin:0;color:var(--accent);}

/* ---------- Buttons ---------- */
.btn,.ctrl,.toggle{
    border-radius:30px;
    padding:14px;
    cursor:pointer;
    user-select:none;
    transition:all .35s ease;
}

.btn{
    background:var(--accent);
    color:#fff;
    font-weight:700;
    margin:18px 0;
    box-shadow:0 10px 25px rgba(0,145,234,.3);
    width:50%;
    height:56px;
    box-sizing:border-box;
    display:flex;
    align-items:center;
    justify-content:center;
    border: none;
}

.btn:hover{box-shadow:0 0 30px rgba(0,145,234,.5);}
.btn:active{transform:translateY(4px) scale(.95);}

.ctrl{
    flex:1;
    background:var(--item);
    text-align:center;
    box-shadow:0 8px 20px rgba(0,0,0,.2);
}
.ctrl:active{transform:translateY(3px) scale(.96);}

.ctrl.active{
    background:var(--accent);
    color:#fff;
    box-shadow:0 0 30px rgba(0,145,234,.5);
}

.toggle{
    background:var(--item);
    padding:10px 18px;
}
.toggle:active{transform:scale(.95);}

input{display:none}

/* ---------- Audio ---------- */
.audio-box{
    background:var(--box);
    padding:14px;
    border-radius:18px;
    transition:box-shadow .6s ease;
}
.audio-box.playing{
    box-shadow:0 0 40px rgba(0,145,234,.4);
}
audio{width:100%}

/* ---------- Controls ---------- */
.controls{
    display:flex;
    gap:14px;
    margin:18px 0;
}

/* ---------- Playlist ---------- */
.playlist{
    max-height:240px;
    overflow-y:auto;
}

.song{
    background:var(--item);
    padding:16px;
    border-radius:18px;
    margin-bottom:12px;
    display:flex;
    justify-content:space-between;
    align-items:center;
    cursor:pointer;
    transition:all .45s ease;
}

.song.active{
    background:var(--accent);
    color:#fff;
    box-shadow:0 8px 20px rgba(0,145,234,.4);
}

.song span{
    flex:1;
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
}

/* ---------- Delete ---------- */
.del{
    width:28px;
    height:28px;
    background:#e53935;
    border-radius:50%;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:900;
}

.song.removing{
    opacity:0;
    transform:translateX(120px);
}
* {
  -webkit-tap-highlight-color: transparent;
}

body {
  -webkit-user-select: none;
  user-select: none;
}

img, a {
  -webkit-touch-callout: none;
}

button, div {
  outline: none;
}
.upload-wrapper{
    position:relative;
}

.upload-btn{
    display:flex;
    align-items:center;
    justify-content:center;
    gap:8px;
    overflow:hidden;
}

/* Loading */
.upload-btn.loading{
    width:60px;
    border-radius:50%;
    background:var(--item);
    box-shadow:none;
    cursor:wait;
}

.loader{
    display:none;
    width:22px;
    height:22px;
    border:3px solid var(--accent);
    border-bottom-color:transparent;
    border-radius:50%;
    animation:spin 1s linear infinite;
}

.loading .loader{
    display:block;
}

.loading .btn-text{
    display:none;
}

/* Success */
.upload-btn.success{
    background:#1b5e20;
    color:#fff;
    width:60%;
}

.success-icon{
    display:none;
    font-size:18px;
}

.success .success-icon{
    display:inline-block;
}

@keyframes spin{
    to{transform:rotate(360deg)}
}
.btn .check{
    display:none;
    margin-left:8px;
}

.btn.success .check{
    display:inline;
}

.btn.loading .btn-text{
    visibility:hidden;
}

.btn.success{
    background:#2e7d32;
    box-shadow:0 0 30px rgba(46,125,50,.8);
}
input[type="range"]{
    display:block;
    -webkit-appearance:none;
    appearance:none;
    height:6px;
    background:var(--item);
    border-radius:10px;
    outline:none;
    width:100%
}

/* Slider thumb */
input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;
    width:18px;
    height:18px;
    background:var(--accent);
    border-radius:50%;
    cursor:pointer;
    box-shadow:0 0 10px rgba(0,145,234,.6);
    /* ---------- MEGA BASS UI ---------- */
.bass-box{
    display:none;
    margin-top:12px;
    padding:14px;
    border-radius:18px;
    background:var(--box);
    animation:slideUp .35s ease;
}

#bassLabel{
    text-align:center;
    font-weight:700;
    margin-bottom:8px;
    color:var(--accent);
    transition:transform .2s ease;
}

@keyframes slideUp{
    from{
        opacity:0;
        transform:translateY(10px);
    }
    to{
        opacity:1;
        transform:translateY(0);
    }
}

/* slider glow while moving */
input[type="range"]:active::-webkit-slider-thumb{
    box-shadow:0 0 20px rgba(0,145,234,.9);
    transform:scale(1.15);
}
}
</style>
</head>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/Beast_Player/sw.js");
}
</script>
<body>

<div class="player">
    <div class="top">
        <h1>Beast Player</h1>
        <div class="toggle" id="modeBtn">Mode</div>
    </div>
<br>
<div class="upload-wrapper">
    <label for="fileInput" class="btn upload-btn" id="addBtn">
        <span class="btn-text">Add Songs</span>
        <div class="loader"></div>
        <span class="success-icon">âœ“</span>
    </label>
    <input type="file" id="fileInput" accept="audio/*" multiple>
</div>
<br>
    <div class="audio-box" id="audioBox">
        <audio id="audio" controls></audio>
    </div>

    <div class="controls">
        <div class="ctrl" id="shuffleBtn">Shuffle</div>
        <div class="ctrl" id="repeatBtn">Repeat: OFF</div>
    </div>
    <div class="ctrl" id="bassBtn", style="margin-bottom:20px">Mega Bass</div>
    <div id="bassControl" class="bass-box">
    <div id="bassLabel", style="margin-left:5px">Bass: 5.0x</div>
    <input type="range" id="bassSlider" min="0" max="10" step="0.5" value="5", style="margin-bottom:10px">
</div>
<br>
    <div class="playlist" id="playlist"></div>
</div>

<script>
let db,songs=[],currentIndex=-1;
let shuffle=false,repeat=0;

const audio=document.getElementById("audio");
/* ---------- MEGA BASS ENGINE ---------- */
const AudioContext = window.AudioContext || window.webkitAudioContext;
const audioCtx = new AudioContext();

const source = audioCtx.createMediaElementSource(audio);


/* ---------- MEGA BASS ---------- */
const bassFilter = audioCtx.createBiquadFilter();
bassFilter.type = "lowshelf";
bassFilter.frequency.value = 120;
bassFilter.gain.value = 0;

/* ---------- CONNECT CHAIN ---------- */
source
  .connect(bassFilter)
  .connect(audioCtx.destination);

// unlock audio on mobile
document.addEventListener("click",()=>{
    if(audioCtx.state !== "running") audioCtx.resume();
},{ once:true });
const playlist=document.getElementById("playlist");
const shuffleBtn=document.getElementById("shuffleBtn");
const repeatBtn=document.getElementById("repeatBtn");
const fileInput=document.getElementById("fileInput");
const audioBox=document.getElementById("audioBox");
const modeBtn=document.getElementById("modeBtn");

/* ---------- HAPTIC ---------- */
const vibrate=(ms=20)=>navigator.vibrate&&navigator.vibrate(ms);

/* ---------- MODE ---------- */
if(localStorage.getItem("mode")==="light")
    document.body.classList.add("light");

modeBtn.onclick=()=>{
    vibrate();
    document.body.classList.toggle("light");
    localStorage.setItem("mode",
        document.body.classList.contains("light")?"light":"dark");
};

/* ---------- DB ---------- */
const req=indexedDB.open("MusicDB",1);
req.onupgradeneeded=e=>{
    e.target.result.createObjectStore("songs",{keyPath:"id",autoIncrement:true});
};
req.onsuccess=e=>{
    db=e.target.result;
    loadSongs();
};

/* ---------- ADD ---------- */
const addBtn = document.getElementById("addBtn");
const btnText = addBtn.querySelector(".btn-text");

fileInput.onchange = e => {
    if (!e.target.files.length) return;

    vibrate(30);

    // Start animation
    addBtn.classList.add("loading");

    const tx = db.transaction("songs", "readwrite");
    const store = tx.objectStore("songs");

    [...e.target.files].forEach(f => {
        store.add({ name: f.name, blob: f });
    });

    tx.oncomplete = () => {
        loadSongs();

        // Success animation
        addBtn.classList.remove("loading");
        addBtn.classList.add("success");
        btnText.textContent = "Added!";

        setTimeout(() => {
            addBtn.classList.remove("success");
            btnText.textContent = "Add Songs";
            fileInput.value = ""; // reset picker
        }, 2000);
    };
};

/* ---------- LOAD ---------- */
function loadSongs(){
    songs=[];
    playlist.innerHTML="";
    const tx=db.transaction("songs","readonly");
    const store=tx.objectStore("songs");

    store.openCursor().onsuccess=e=>{
        const cur=e.target.result;
        if(!cur) return;

        const index=songs.length;
        songs.push(cur.value);

        const div=document.createElement("div");
        div.className="song";
        div.innerHTML=`<span>${cur.value.name}</span>`;
        div.onclick=()=>play(index);

        const del=document.createElement("div");
        del.className="del";
        del.textContent="Ã—";
        del.onclick=ev=>{
            ev.stopPropagation();
            vibrate(25);
            div.classList.add("removing");
            deleteSong(cur.key,div);
        };

        div.appendChild(del);
        playlist.appendChild(div);
        cur.continue();
    };
}

/* ---------- DELETE ---------- */
function deleteSong(id,el){
    const tx=db.transaction("songs","readwrite");
    tx.objectStore("songs").delete(id);
    tx.oncomplete=()=>setTimeout(loadSongs,400);
}

/* ---------- PLAY ---------- */
function play(i){
    if(!songs[i]) return;
    currentIndex=i;
    audio.src=URL.createObjectURL(songs[i].blob);
    audio.play();
    highlight();
    updateMedia();
}

audio.onplay=()=>audioBox.classList.add("playing");
audio.onpause=()=>audioBox.classList.remove("playing");

audio.onended=()=>{
    if(repeat===1) return audio.play();
    if(shuffle) return play(Math.floor(Math.random()*songs.length));
    if(currentIndex<songs.length-1) play(currentIndex+1);
    else if(repeat===2) play(0);
};

/* ---------- BUTTONS ---------- */
shuffleBtn.onclick=()=>{
    vibrate();
    shuffle=!shuffle;
    shuffleBtn.classList.toggle("active",shuffle);
};

repeatBtn.onclick=()=>{
    vibrate();
    repeat=(repeat+1)%3;
    repeatBtn.textContent=["Repeat: OFF","Repeat: ONE","Repeat: ALL"][repeat];
    repeatBtn.classList.toggle("active",repeat!==0);
};

/* ---------- UI ---------- */
function highlight(){
    document.querySelectorAll(".song").forEach((s,i)=>{
        s.classList.toggle("active",i===currentIndex);
    });
}

/* ---------- MEDIA SESSION ---------- */
function updateMedia(){
    if(!navigator.mediaSession) return;

    const colors=["#0d47a1","#1565c0","#1976d2","#0277bd","#01579b"];
    const c=colors[Math.floor(Math.random()*colors.length)];

    navigator.mediaSession.metadata=new MediaMetadata({
        title:songs[currentIndex].name,
        artist:"Beast Player",
        artwork:[{src:`data:image/svg+xml,
        <svg xmlns='http://www.w3.org/2000/svg' width='300' height='300'>
        <rect width='300' height='300' fill='${c}'/></svg>`}]
    });

    navigator.mediaSession.setActionHandler("nexttrack",()=>{
        if(currentIndex<songs.length-1) play(currentIndex+1);
    });
    navigator.mediaSession.setActionHandler("previoustrack",()=>{
        if(currentIndex>0) play(currentIndex-1);
    });
}


const bassBtn = document.getElementById("bassBtn");
const bassSlider = document.getElementById("bassSlider");
const bassControl = document.getElementById("bassControl");
const bassLabel = document.getElementById("bassLabel");

/* ---------- MEGA BASS DEFAULT STATE ---------- */
let bassOn = true; // ðŸ‘ˆ ON by default

// initial UI sync
bassBtn.classList.add("active");
bassControl.style.display = "block";
bassFilter.gain.value = bassSlider.value;
bassLabel.textContent = `MEGA BASS: ${bassSlider.value}x`;

/* ---------- BUTTON ---------- */
bassBtn.onclick = () => {
    vibrate(30);

    bassOn = !bassOn;

    bassBtn.classList.toggle("active", bassOn);
    bassControl.style.display = bassOn ? "block" : "none";
    bassFilter.gain.value = bassOn ? bassSlider.value : 0;
};

/* ---------- SLIDER ---------- */
bassSlider.oninput = () => {
    if (!bassOn) return;

    bassFilter.gain.value = bassSlider.value;
    bassLabel.textContent = `Bass: ${bassSlider.value}x`;

    // haptic + animation
    vibrate(8);
    bassLabel.style.transform = "scale(1.08)";
    setTimeout(() => bassLabel.style.transform = "scale(1)", 100);
};
</script>

</body>
</html>
