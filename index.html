<!DOCTYPE html>  <html lang="en">  
<head>  
<link rel="manifest" href="manifest.json">  
<meta name="theme-color" content="#0077be">  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
<meta charset="UTF-8">  
<script src="https://cdn.jsdelivr.net/npm/jsmediatags@3.9.7/dist/jsmediatags.min.js"></script>
<title>Beast Player</title>  <style>  
:root{  
    --bg:#050a0f;      /* Darker Navy */  
    --card:#0d151f;    /* Deep Slate */  
    --box:#091018;       
    --item:#162431;    /* Muted Blue-Grey */  
    --text:#d1e3f0;  
    --accent:#0091ea;  /* Deeper Azure */  
}  
  
body.light{  
    --bg:#e1e9f0;      /* Lighter Steel Blue */  
    --card:#f5f9fc;    /* Clean White-Blue */  
    --box:#d4e1ec;  
    --item:#c5d4e1;  
    --text:#051a2b;    /* Deep Navy Text */  
    --accent:#0077c2;  /* Unified Azure for Light Mode */  
}  
  
body{  
    margin:0;  
    background:var(--bg);  
    color:var(--text);  
    font-family:system-ui, Arial;  
    display:flex;  
    justify-content:center;  
    align-items:center;  
    height:100vh;  
    transition:background .8s,color .8s;  
}  
  
.player{  
    width:94%;  
    max-width:420px;  
    background:var(--card);  
    padding:22px;  
    border-radius:26px;  
    box-shadow:0 25px 60px rgba(0,0,0,.5);  
}  
  
.top{  
    display:flex;  
    justify-content:space-between;  
    align-items:center;  
}  
  
h1{margin:0;color:var(--accent);}  
  
/* ---------- Buttons ---------- */  
.btn,.ctrl,.toggle{  
    border-radius:30px;  
    padding:14px;  
    cursor:pointer;  
    user-select:none;  
    transition:all .35s ease;  
}  
  
.btn{  
    background:var(--accent);  
    color:#fff;  
    font-weight:700;  
    margin:18px 0;  
    box-shadow:0 10px 25px rgba(0,145,234,.3);  
    width:50%;  
    height:56px;  
    box-sizing:border-box;  
    display:flex;  
    align-items:center;  
    justify-content:center;  
    border: none;  
}  
  
.btn:hover{box-shadow:0 0 30px rgba(0,145,234,.5);}  
.btn:active{transform:translateY(4px) scale(.95);}  
  
.ctrl{  
    flex:1;  
    background:var(--item);  
    text-align:center;  
    box-shadow:0 8px 20px rgba(0,0,0,.2);  
}  
.ctrl:active{transform:translateY(3px) scale(.96);}  
  
.ctrl.active{  
    background:var(--accent);  
    color:#fff;  
    box-shadow:0 0 30px rgba(0,145,234,.5);  
}  
  
.toggle{  
    background:var(--item);  
    padding:10px 18px;  
}  
.toggle:active{transform:scale(.95);}  
  
input{display:none}  
  
/* ---------- Audio ---------- */  
.audio-box{  
    background:var(--box);  
    padding:14px;  
    border-radius:18px;  
    transition:box-shadow .6s ease;  
}  
.audio-box.playing{  
    box-shadow:0 0 40px rgba(0,145,234,.4);  
}  
audio{width:100%}  
  
/* ---------- Controls ---------- */  
.controls{  
    display:flex;  
    gap:14px;  
    margin:18px 0;  
}  
  
/* ---------- Playlist ---------- */  
.playlist{  
    max-height:240px;  
    overflow-y:auto;  
}  
  
.song{  
    background:var(--item);  
    padding:16px;  
    border-radius:18px;  
    margin-bottom:12px;  
    display:flex;  
    justify-content:space-between;  
    align-items:center;  
    cursor:pointer;  
    transition:all .45s ease;  
}  
  
.song.active{  
    background:var(--accent);  
    color:#fff;  
    box-shadow:0 8px 20px rgba(0,145,234,.4);  
}  
  
.song span{  
    flex:1;  
    white-space:nowrap;  
    overflow:hidden;  
    text-overflow:ellipsis;  
}  
  
/* ---------- Delete ---------- */  
.del{  
    width:28px;  
    height:28px;  
    background:#e53935;  
    border-radius:50%;  
    display:flex;  
    align-items:center;  
    justify-content:center;  
    color:white;  
    font-weight:900;  
}  
  
.song.removing{  
    opacity:0;  
    transform:translateX(120px);  
}  
* {  
  -webkit-tap-highlight-color: transparent;  
}  
  
body {  
  -webkit-user-select: none;  
  user-select: none;  
}  
  
img, a {  
  -webkit-touch-callout: none;  
}  
  
button, div {  
  outline: none;  
}  
.upload-wrapper{  
    position:relative;  
}  
  
.upload-btn{  
    display:flex;  
    align-items:center;  
    justify-content:center;  
    gap:8px;  
    overflow:hidden;  
}  
  
/* Loading */  
.upload-btn.loading{  
    width:60px;  
    border-radius:50%;  
    background:var(--item);  
    box-shadow:none;  
    cursor:wait;  
}  
  
.loader{  
    display:none;  
    width:22px;  
    height:22px;  
    border:3px solid var(--accent);  
    border-bottom-color:transparent;  
    border-radius:50%;  
    animation:spin 1s linear infinite;  
}  
  
.loading .loader{  
    display:block;  
}  
  
.loading .btn-text{  
    display:none;  
}  
  
/* Success */  
.upload-btn.success{  
    background:#1b5e20;  
    color:#fff;  
    width:60%;  
}  
  
.success-icon{  
    display:none;  
    font-size:18px;  
}  
  
.success .success-icon{  
    display:inline-block;  
}  
  
@keyframes spin{  
    to{transform:rotate(360deg)}  
}  
.btn .check{  
    display:none;  
    margin-left:8px;  
}  
  
.btn.success .check{  
    display:inline;  
}  
  
.btn.loading .btn-text{  
    visibility:hidden;  
}  
  
.btn.success{  
    background:#2e7d32;  
    box-shadow:0 0 30px rgba(46,125,50,.8);  
}  
</style>  </head>  
<script>  
if ("serviceWorker" in navigator) {  
  navigator.serviceWorker.register("/Beast_Player/sw.js");  
}  
</script>  
<body>  <div class="player">  
    <div class="top">  
        <h1>Beast Player</h1>  
        <div class="toggle" id="modeBtn">Mode</div>  
    </div>  
<br>  
<div class="upload-wrapper">  
    <label for="fileInput" class="btn upload-btn" id="addBtn">  
        <span class="btn-text">Add Songs</span>  
        <div class="loader"></div>  
        <span class="success-icon">âœ“</span>  
    </label>  
    <input type="file" id="fileInput" accept="audio/*" multiple>  
</div>  
<br>  
    <div class="audio-box" id="audioBox">  
        <audio id="audio" controls></audio>  
    </div>  <div class="controls">  
    <div class="ctrl" id="shuffleBtn">Shuffle</div>  
    <div class="ctrl" id="repeatBtn">Repeat: OFF</div>  
</div>  

<div class="playlist" id="playlist"></div>

</div>  <script>  
let db,songs=[],currentIndex=-1;  
let shuffle=false,repeat=0;  
  
const audio=document.getElementById("audio");  
const playlist=document.getElementById("playlist");  
const shuffleBtn=document.getElementById("shuffleBtn");  
const repeatBtn=document.getElementById("repeatBtn");  
const fileInput=document.getElementById("fileInput");  
const audioBox=document.getElementById("audioBox");  
const modeBtn=document.getElementById("modeBtn");  
let mediaToken = 0;
const fallbackArtCache = {};
  
/* ---------- HAPTIC ---------- */  
const vibrate=(ms=40)=>navigator.vibrate&&navigator.vibrate(ms);  
  
/* ---------- MODE ---------- */  
if(localStorage.getItem("mode")==="light")  
    document.body.classList.add("light");  
  
modeBtn.onclick=()=>{  
    vibrate();  
    document.body.classList.toggle("light");  
    localStorage.setItem("mode",  
        document.body.classList.contains("light")?"light":"dark");  
};  
  
/* ---------- DB ---------- */  
const req=indexedDB.open("MusicDB",1);  
req.onupgradeneeded=e=>{  
    e.target.result.createObjectStore("songs",{keyPath:"id",autoIncrement:true});  
};  
req.onsuccess=e=>{  
    db=e.target.result;  
    loadSongs();  
};  
  
/* ---------- ADD ---------- */  
const addBtn = document.getElementById("addBtn");  
const btnText = addBtn.querySelector(".btn-text");  
  
fileInput.onchange = e => {  
    if (!e.target.files.length) return;  
  
    vibrate(30);  
  
    // Start animation  
    addBtn.classList.add("loading");  
  
    const tx = db.transaction("songs", "readwrite");  
    const store = tx.objectStore("songs");  
  
    [...e.target.files].forEach(f => {  
        store.add({ name: f.name, blob: f });  
    });  
  
    tx.oncomplete = () => {  
        loadSongs();  
  
        // Success animation  
        addBtn.classList.remove("loading");  
        addBtn.classList.add("success");  
        btnText.textContent = "Added!";  
  
        setTimeout(() => {  
            addBtn.classList.remove("success");  
            btnText.textContent = "Add Songs";  
            fileInput.value = ""; // reset picker  
        }, 2000);  
    };  
};  
  
/* ---------- LOAD ---------- */  
function loadSongs(){  
    songs=[];  
    playlist.innerHTML="";  
    const tx=db.transaction("songs","readonly");  
    const store=tx.objectStore("songs");  
  
    store.openCursor().onsuccess=e=>{  
        const cur=e.target.result;  
        if(!cur) return;  
  
        const index=songs.length;  
        songs.push(cur.value);  
  
        const div=document.createElement("div");  
        div.className="song";  
        div.innerHTML=`<span>${cur.value.name}</span>`;  
        div.onclick=()=>play(index);  
  
        const del=document.createElement("div");  
        del.className="del";  
        del.textContent="Ã—";  
        del.onclick=ev=>{  
            ev.stopPropagation();  
            vibrate(30);  
            div.classList.add("removing");  
            deleteSong(cur.key,div);  
        };  
  
        div.appendChild(del);  
        playlist.appendChild(div);  
        cur.continue();  
    };  
}  
  
/* ---------- DELETE ---------- */  
function deleteSong(id,el){  
    const tx=db.transaction("songs","readwrite");  
    tx.objectStore("songs").delete(id);  
    tx.oncomplete=()=>setTimeout(loadSongs,400);  
}  
  
/* ---------- PLAY ---------- */  
function play(i){  
    if(!songs[i]) return;  
    currentIndex=i;  
    audio.src=URL.createObjectURL(songs[i].blob);  
    audio.play();  
    highlight();  
    updateMedia();  
}  
  
audio.onplay=()=>audioBox.classList.add("playing");  
audio.onpause=()=>audioBox.classList.remove("playing");  
  
audio.onended=()=>{  
    if(repeat===1) return audio.play();  
    if(shuffle) return play(Math.floor(Math.random()*songs.length));  
    if(currentIndex<songs.length-1) play(currentIndex+1);  
    else if(repeat===2) play(0);  
};  
  
/* ---------- BUTTONS ---------- */  
shuffleBtn.onclick=()=>{  
    vibrate();  
    shuffle=!shuffle;  
    shuffleBtn.classList.toggle("active",shuffle);  
};  
  
repeatBtn.onclick=()=>{  
    vibrate();  
    repeat=(repeat+1)%3;  
    repeatBtn.textContent=["Repeat: OFF","Repeat: ONE","Repeat: ALL"][repeat];  
    repeatBtn.classList.toggle("active",repeat!==0);  
};  
  
/* ---------- UI ---------- */  
function highlight(){  
    document.querySelectorAll(".song").forEach((s,i)=>{  
        s.classList.toggle("active",i===currentIndex);  
    });  
}  
function getArtwork(blob, callback){
    jsmediatags.read(blob, {
        onSuccess: tag => {
            const pic = tag.tags.picture;
            if(!pic) return callback(null);

            const bytes = new Uint8Array(pic.data);
            const imgBlob = new Blob([bytes], { type: pic.format });
            callback(URL.createObjectURL(imgBlob));
        },
        onError: () => callback(null)
    });
}
  
/* ---------- MEDIA SESSION ---------- */  
function updateMedia(){
    if(!navigator.mediaSession) return;

    const song = songs[currentIndex];
    const token = ++mediaToken; // ðŸ”’ lock this call

    getArtwork(song.blob, artUrl => {

        // âŒ ignore outdated callbacks
        if (token !== mediaToken) return;

        // ðŸŽ¨ fallback artwork
        if (!artUrl) {
            if (!fallbackArtCache[song.name]) {
                fallbackArtCache[song.name] =
                    generateFallbackArtwork(song.name);
            }
            artUrl = fallbackArtCache[song.name];
        }

        navigator.mediaSession.metadata = new MediaMetadata({
            title: song.name,
            artist: "Beast Player",
            artwork: [{
                src: artUrl,
                sizes: "512x512",
                type: "image/png"
            }]
        });
    });
}
function rand(){
    return Math.floor(Math.random() * 256);
}

function randomColor(){
    return `rgb(${rand()}, ${rand()}, ${rand()})`;
}
function generateFallbackArtwork(title){
    const canvas = document.createElement("canvas");
    canvas.width = canvas.height = 512;
    const ctx = canvas.getContext("2d");

    // ðŸŽ¨ unlimited random gradient
    const grad = ctx.createLinearGradient(0, 0, 512, 512);
    grad.addColorStop(0, randomColor());
    grad.addColorStop(1, randomColor());

    ctx.fillStyle = grad;
    ctx.fillRect(0, 0, 512, 512);

    // ðŸŽµ song title text
    ctx.fillStyle = "rgba(255,255,255,0.9)";
    ctx.font = "bold 48px system-ui";
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    ctx.fillText(title.slice(0, 18), 256, 256);

    return canvas.toDataURL("image/png");
}
if ("mediaSession" in navigator) {
    navigator.mediaSession.setActionHandler("nexttrack", () => {
        if (shuffle) play(Math.floor(Math.random() * songs.length));
        else if (currentIndex < songs.length - 1) play(currentIndex + 1);
        else if (repeat === 2) play(0);
    });

    navigator.mediaSession.setActionHandler("previoustrack", () => {
        if (audio.currentTime > 5) audio.currentTime = 0;
        else if (currentIndex > 0) play(currentIndex - 1);
    });
}
</script>
</body>  
</html> 
